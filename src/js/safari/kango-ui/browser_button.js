kango.ui.BrowserButton=function(a){this.superclass.apply(this,arguments);var b=this;safari.application.addEventListener("command",function(a){a.command===b._commandName&&b._onClicked()},!1);safari.application.addEventListener("popover",function(){var a=b._getButton();null!=a&&a.popover.contentWindow.location.reload()},!0);this._initDetails(a)};
kango.ui.BrowserButton.prototype=kango.oop.extend(kango.ui.ButtonBase,{_popupHostUrl:"kango-ui/remote_popup_host.html",_popupDetails:null,_id:"kango-ui-button",_commandName:"KangoButtonCommand",_getButton:function(){for(var a=safari.extension.toolbarItems,b=0;b<a.length;b++)if(a[b].identifier==this._id)return a[b];return null},_removePopup:function(){var a=this._getButton();a.popover=null;safari.extension.removePopover("kango-ui-popup");a.command=this._commandName},_setPopup:function(a,b){if(null!=
b&&kango.lang.isString(b.url)){var c="",d=b.height,e=b.width;null!=b&&kango.lang.isString(b.url)&&(kango.io.isLocalUrl(b.url)?c=b.url:(c=this._popupHostUrl,d+=4));this._removePopup();a.popover=safari.extension.createPopover("kango-ui-popup",safari.extension.baseURI+c,e,d);a.command=null;a.popover.width=b.width;a.popover.height=d}else this._removePopup()},setTooltipText:function(a){this._getButton().toolTip=a.replace(/\n/g,"; ").replace(/\r/g,"")},setCaption:function(){},setIcon:function(a){this._getButton().image=
safari.extension.baseURI+a},setBadgeValue:function(a){null!=a&&(this._getButton().badge=parseInt(a,10))},setBadgeBackgroundColor:function(){},setPopup:function(a){this._popupDetails=a;var b=this._getButton();if(b.popover&&b.popover.visible){var c=this;window.setTimeout(function(){c.setPopup(c._popupDetails)},100)}else this._setPopup(b,a)},closePopup:function(){var a=this._getButton();null!=a&&null!=a.popover&&a.popover.hide()},getPopupDetails:function(){return this._popupDetails},setContextMenu:function(){},
_onClicked:function(){return this.fireEvent(this.event.COMMAND)},_initDetails:function(a){kango.lang.isObject(a)&&(kango.lang.isString(a.icon)&&this.setIcon(a.icon),kango.lang.isString(a.caption)&&this.setCaption(a.caption),kango.lang.isString(a.tooltipText)&&this.setTooltipText(a.tooltipText),kango.lang.isObject(a.popup)?this.setPopup(a.popup):(a=this._getButton(),a.command="KangoButtonCommand",a.popover=null))}});
